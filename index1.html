<!DOCTYPE html>
<!DOCTYPE html>
<html>
<head>
  <title>comments</title>
  <link rel="stylesheet" type="text/css" href="index.css">
</head>
<body>

     <p>click on comments to comment on the video</p>
     <p>after commenting click on commets to hide it</p>
      <div id="video">
       
            
            <iframe width="560" height="315" src="https://www.youtube.com/embed/Wn96FZtQC-w" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
            <a id="com" onclick="display()" >comments</a>
          <div id="comm">
              
            </div>
        
         
      </div>



  <script type="text/javascript">
  var person;  
  localStorage.clear();
  //taking name from the user   
      var fun=function()
      {
       person = prompt("Please enter your name", "");
      };
      fun();
      while(!person||person.lenght==0)
      {
        alert("you have to enter the name");
         person = prompt("Please enter your name", "");
      }
  var disp=0;
   //cheking if there are comments before
   if(localStorage.getItem("no_of")===null)
   {
    console.log("its just started");
    localStorage.setItem("no_of","0")
   }
   function display()
   {
        if(disp==1)
        {
        document.getElementById("comm").innerHTML="";
        disp=0;
        }
        else
        {
        var div=document.createElement("DIV");
        div.style.backgroundColor='#D3D3D3';
        console.log("div done");
        var inp=document.createElement("INPUT");
        inp.setAttribute("type","text");
        inp.setAttribute("size",'74%');
        console.log("inp done");
        var sub=document.createElement("button");
        var t=document.createTextNode("submit");

        sub.appendChild(t);
        sub.addEventListener("click",onSubmit);
        console.log("sub done");
        var c=document.getElementById('comm');
        div.appendChild(inp);
        div.appendChild(sub);
        c.appendChild(div);
        commentsDom();
        disp=1;
      }
   }
   

   function onSubmit()
   {
       var no_com=Number(localStorage.no_of)+1;
       var date=new Date();
       var c=document.getElementsByTagName("INPUT")[0].value;
       var obj={
          name:person,
          com:c,
          time:date.getTime()
       }
       localStorage.setItem(no_com,JSON.stringify(obj));
       console.log("this is ",no_com);
       localStorage.no_of=Number(localStorage.no_of)+1;
      
       commentsDom();
   }
   function commentsDom()
   {
     var list=document.getElementsByClassName("del");
       while(list.length>0)
       {
        list[0].parentNode.removeChild(list[0]);
       }
    var i=1;
    var end=Number(localStorage.no_of);
   
    while(i<=end)
    {
      console.log(i);
       var robj=localStorage.getItem(i);
       if(robj===null)
        {
          i++;
          continue;
        }
       var r=JSON.parse(robj);
       var per=r.name;
       var comment=r.com;


      var div=document.createElement("DIV");
        div.setAttribute("class","del");
        var name=document.createElement("b");
        var n=document.createTextNode(per.charAt(0).toUpperCase()+person.slice(1));
        name.appendChild(n);
        name.setAttribute("id",i);
        var ed=document.createElement("a");
        var te=document.createTextNode("edit");
        ed.appendChild(te);
        ed.setAttribute("class","edit");
        ed.addEventListener("click",edit);
        name.appendChild(ed);
        var de=document.createElement("a");
        var det=document.createTextNode("delete");
        de.appendChild(det);
        de.setAttribute("class","edit");
        de.addEventListener("click",dele);
        name.appendChild(de);
        var next=document.createElement("br");
        name.appendChild(next);
        div.style.backgroundColor='#D3D3D3';
        div.appendChild(name);
        var pin=document.createElement("p");
        pin.style.marginTop="0px";
        pin.style.marginBottom="0px";
       
        var t=document.createTextNode(comment);
        pin.appendChild(t);
        div.appendChild(pin);
       

        var c=document.getElementById("comm");
        c.appendChild(div);
        var inp=document.getElementsByTagName("INPUT")[0].value="";
        i++;
    }

    function edit(e)
    {

        var target=e.target;
        var b=target.parentNode.id;
        var obj=JSON.parse(localStorage.getItem(b));
        if(person!=obj.name)
        {
          alert("sorry !1 you cant edit this :)");
        }
        else
        {
          console.log(obj.com);
        document.getElementsByTagName("INPUT")[0].value="raman";
        localStorage.removeItem(b);
        }
        commentsDom();
    }
   }
   function dele(e)
   {
        var target=e.target;
        var b=target.parentNode.id;
        var obj=JSON.parse(localStorage.getItem(b));
        if(person!=obj.name)
        {
          alert("sorry !1 you cant delete this :(");
        }
        else
        {
        localStorage.removeItem(b);
        }
        commentsDom();
   }
  </script>
       
</body>
</html>